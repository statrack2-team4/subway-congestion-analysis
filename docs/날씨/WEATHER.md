# 📌 날씨 영향 분석

**핵심 아이디어**: 날씨가 나쁠수록 지하철 이용 증가, 하지만 "너무 나쁘면" 오히려 통행량 감소

# 프로젝트 개요

주제 : 날씨가 지하철 승차 인원에 미치는 영향 분석

기간 : 2023년 1월 ~ 2024년 12월 (731일)

가설 : "날씨가 나쁠수록 지하철 이용 증가, 하지만 '너무 나쁘면' 오히려 통행량 감소"

---

# 구간별 분석

## **1) 강수량**

- 0~5mm: 약간 증가 (우산 쓰고 다님)
- 5~20mm: 급격히 증가 (버스→지하철 전환)
- 20mm 이상: 오히려 감소 (재택근무, 외출 취소)

---

## **2) 온도**

- 폭염(30도 이상): 에어컨 있는 지하철 선호
- 한파(-5도 이하): 실내 대중교통 선호
- 쾌적한 날씨(15-25도): 도보/자전거 증가로 지하철 감소

---

# STEP 1: 데이터 전처리 및 통합

## 1-1. 날씨 데이터 가공

```sql
필요한 변수 생성:
- 일별 평균 기온
- 일별 강수 여부 (rain_type > 0)
- 일별 강수 시간 수 (몇 시간 동안 비가 왔는가)
- 온도 구간 분류:
  * 한파: < -5°C
  * 추움: -5 ~ 5°C
  * 쾌적: 5 ~ 25°C
  * 더움: 25 ~ 30°C
  * 폭염: > 30°C
```

## 1-2. 지하철 데이터 가공

```sql
필요한 변수 생성:
- 일별 전체 승차 인원 (모든 역, 모든 시간대 합산)
- 시간대별 승차 인원 (출근: 7-9시, 퇴근: 18-20시)
- 역별 일일 승차 인원
- 평일/주말 구분
```

## 1-3. 데이터 통합

```sql
날씨 + 지하철 데이터 병합 (날짜 기준)
→ 최종 데이터셋: [날짜, 요일, 기온, 강수여부, 강수시간, 전체승차인원, 출근시간승차, 퇴근시간승차]
```

---

# STEP 2: 탐색적 데이터 분석 (EDA)

## 2-1. 기초 통계

- 날씨별 일평균 승차 인원 

- 온도 구간별 승차 인원 분포 

- 강수 여부에 따른 승차 인원 차이

---

## 2-2. 시각화

### 1️⃣ 기온 vs 승차인원 산점도

**목적**: U자형 패턴 확인, 한파/폭염 구간에서 승차 인원 감소 확인

**📈 그래프 구성**

```sql
X축: 평균 기온 (°C) - 약 -20°C ~ 40°C 범위
Y축: 일일 승차 인원 (백만명) - 1M ~ 6M 범위
파란 점: 맑은 날 (531일)
분홍 사각형: 비 온 날 (200일)
회색 점선: 평일 데이터의 2차 추세선
파란 배경: 한파 구간 (-20°C ~ -5°C)
주황 배경: 폭염 구간 (30°C ~ 40°C)
```

![graph1.png](attachment:411b8475-695e-4a58-9485-ee2885d007cd:graph1.png)

**🔍 주요 발견**

**1. U자형 패턴 명확**

```python
20°C → 2-3M명 (최저)
5°C → 4M명
10-20°C → 5-6M명 (최고) ⭐
30°C → 4.5M명
35°C → 3-4M명 (감소)
```

**2. 최적 온도 구간**

- 10-20°C에서 데이터가 가장 밀집
- 이 구간에서 승차 인원이 최대 (5-6M명)
- "쾌적한 날씨"에서 외출 활동 최대

**3. 극한 온도의 영향**

- **한파 (<-5°C)**: 급격한 감소
    - 실제 사례: 2023년 1월 24일 -15°C → 2.8M명
    - 재택근무, 외출 자제, 조기 하교
- **폭염 (>30°C)**: 점진적 감소
    - 실제 사례: 2023년 8월 3일 34°C → 3.9M명
    - 냉방 시설 있는 집/건물에서 대기
    - 야외 활동 자제

**4. 비의 영향**

- 분홍 사각형(비 온 날)이 파란 점(맑은 날)보다 약간 아래
- 하지만 온도만큼 큰 영향은 아님
- 비+극한온도 조합이 최악

**5. 추세선 분석**

- 2차 함수 형태로 U자 곡선
- 정점(최대값)이 15°C 부근
- 양쪽 끝으로 갈수록 급격히 감소

💡 실무적 의미

- **배차 계획**: 15°C 전후 날씨에 최대 배차
- **극한 날씨 예보 시**: 배차 20% 감축 가능
- **공휴일 계획**: 날씨 고려한 운영 필요

### 2️⃣ 온도 구간별 박스플롯

**목적**: 온도 구간별 승차 인원 분포 비교, 평일 vs 전체 비교

**📈 그래프 구성**

```python
- 한파 / 추움 / 쾌적 / 더움 / 폭염
- 각 구간별 승차인원 분포
→ 목표: 어느 구간에서 승차인원이 가장 많은가?

**왼쪽: 전체 데이터 (평일+주말)**
- 5개 박스: 한파/추움/쾌적/더움/폭염
- 빨간 다이아몬드: 평균값
- 박스 색상: 한파(하늘색), 쾌적(회색), 폭염(주황)

**오른쪽: 평일만**
- 동일한 구조이지만 평일 데이터만
- 주말 효과 제거하여 순수 날씨 영향 확인
```

![graph2.png](attachment:b5efe559-88df-4aa1-bfa6-01a8a7a9fa06:graph2.png)

**🔍 박스플롯 읽는 법**

```python
    상단 수염 (최댓값)
         |
    ┌────┴────┐
    │         │ 75% (Q3)
    │    ◆   │ ← 평균 (빨간 다이아몬드)
    │    ─    │ 50% (중앙값)
    │         │ 25% (Q1)
    └────┬────┘
         |
    하단 수염 (최솟값)
```

**🔍 구간별 상세 분석**

한파 (<-5°C, 18일)

```python
전체: 평균 3.1M, 범위 1.4-4.2M
평일: 평균 4.2M, 범위 2.8-5.0M
특징: 박스가 가장 넓음 (변동성 큼)

- 변동성이 큰 이유: 한파 + 주말 조합 시 1.4M까지 급락
- 평일도 낮지만 최소한의 출근은 발생
```

추움 (-5~5°C, 166일)

```python
전체: 평균 4.0M, 범위 2.0-5.5M
평일: 평균 4.7M, 범위 4.0-5.5M
특징: 박스 폭이 좁아짐 (안정적)

- 겨울 평균 날씨
- 일관되게 중간 수준 유지
```

쾌적 (5~25°C, 398일) ⭐

```python
전체: 평균 4.6M, 범위 2.5-6.0M
평일: 평균 5.0M, 범위 4.5-5.7M
특징: 최고값, 가장 안정적
- **최대 승차 구간**
- 봄/가을 날씨
- 중앙값과 평균이 가장 높음
- 박스가 위쪽에 위치
```

**더움 (25~30°C, 136일)**

```python
전체: 평균 4.2M, 범위 2.0-5.5M
평일: 평균 4.8M, 범위 4.0-5.5M
특징: 쾌적보다 약간 낮음
- 여름 초입
- 아직 견딜 만한 수준
- 쾌적과 비슷한 패턴
```

폭염 (>30°C, 13일)

```python
전체: 평균 3.8M, 범위 2.0-5.0M
평일: 평균 4.6M, 범위 4.0-5.1M
특징: 명확한 감소, 상한선 낮음
- 여름 극한 날씨
- 최댓값도 5.1M으로 제한
- 외출 자체가 감소
```

**🔍 전체 vs 평일 비교**

**주요 차이점:**

1. **평일이 항상 높음**
    - 쾌적: 전체 4.6M → 평일 5.0M (+9%)
    - 주말은 3M 수준으로 낮음
2. **주말 효과가 날씨별로 다름**
    - 한파: 전체 3.1M, 평일 4.2M (차이 35%)
    - 쾌적: 전체 4.6M, 평일 5.0M (차이 9%)
    - → 날씨 나쁠수록 주말 영향 큼
3. **변동성 패턴**
    - 전체: 박스가 길고 넓음 (주말 영향)
    - 평일: 박스가 짧고 일정 (안정적)

**💡 핵심 인사이트**

**1. 임계점 명확**

```python
- 쾌적한 날씨: 평일 5.0M명 (최대)
- 한파: 평일 4.2M명 (-13.6%)
- 폭염: 평일 4.6M명 (-5.6%)
- 한파가 폭염보다 영향 큼
```

**2. 한파가 폭염보다 2배 이상 영향**

- 한파: -0.8M명 감소
- 폭염: -0.4M명 감소
- 이유: 한국은 난방보다 냉방 인프라가 우수

**3. 박스의 위치로 일관성 확인**

- 쾌적 > 더움 > 추움 > 폭염 > 한파
- 순서가 명확하게 구분됨
- 우연이 아닌 체계적 패턴

**4. 이상치(outlier) 분석**

- 한파 구간의 아래쪽 이상치: 한파+공휴일
- 쾌적 구간의 아래쪽 이상치: 평일 공휴일

**📊 실무 활용**

**배차 계획:**

```python
쾌적 (15°C): 100% 배차
더움 (28°C): 95% 배차
추움 (0°C): 90% 배차
폭염 (33°C): 85% 배차
한파 (-8°C): 75% 배차 ⚠️
```

**예측 정확도:**

- 평일 박스 내 분포: 예측 가능
- 평일 박스 밖: 특수 상황 고려 필요

### 3️⃣ 강수량 구간별 평균 승차 인원 (평일)

**목적**: 강수량(mm) 기반 임계점 발견 - 50mm가 임계점!

**📈 그래프 구성**

```python
X축: 강수량 구간 (맑음 / 약한비 / 보통비 / 강한비 / 폭우)
Y축: 평균 승차 인원 (백만명) - 0~5M 범위
녹색 점선: 기준선 (평일 평균 4.9M)
막대 색상:
파란색 (맑음): 기준선보다 높음 (+증가)
분홍색 (약한비~폭우): 기준선보다 낮음 (-감소)
특징 : 평일만 분석
- 주말 효과 제거: 순수한 날씨 영향만 보기 위해
- 통근 패턴 분석: 출퇴근 수요에 집중
- 정책 적용: 평일 배차 계획에 활용
```

**맑음 
(0mm):**
 n=360일
 평균: 4.9M
 변화: +0.7%

**약한비 (<5mm):**
n=93일
평균: 4.8M
변화: -1.2%

**보통비
(5-20mm):**
 n=38일
 평균: 4.8M
 변화: -0.1%

**강한비
(20-50mm):**
 n=19일
 평균: 4.8M
 변화: -1.3%

**폭우 (50mm+):**
 n=12일
 평균: 4.5M
 변화: -8.9%

 (⚠️임계점)

![graph3.png](attachment:1d5a32c0-0a6c-46f2-863f-d324342018dd:graph3.png)

**💡 이 그래프가 보여주는 것** 

**"비가 오면 지하철 이용이 줄어든다"는 일반적 예상과 달리:**

- 약한~강한비 (<50mm): 거의 영향 없음
- 폭우 (50mm+): 급격한 감소

### 4️⃣ 출퇴근 시간대별 강수량 영향

**목적**: 출근 vs 퇴근 시간대의 날씨 민감도 비교

```sql
**📈 시각화 4: 출퇴근 시간대별 날씨 영향**
- 출근시간(7-9시) vs 퇴근시간(18-20시)
- 날씨별 비교 (맑음 / 비 / 폭염 / 한파)
→ 목표: 어느 시간대가 날씨에 더 민감한가?
```

![graph4.png](attachment:fff97bb7-65b6-4ca8-91bb-dedc727cb5a3:graph4.png)

📌 주요 발견:

- 출근시간이 퇴근시간보다 날씨에 더 민감
- 폭우: 출근 -10%, 퇴근 -6%
- 약한비: 출퇴근 거의 영향 없음
- 출근은 재택 선택 가능, 퇴근은 필수

### 5️⃣ 시간적 패턴 (월별/계절별/요일별/연도별)

**목적**: 시간에 따른 승차 인원 패턴 분석

```sql
**📈 **
- 계절별로 온도와 승차인원 관계 변화
- 1~3월(겨울), 4~6월(봄), 7~9월(여름), 10~12월(가을)
→ 목표: 계절별로 날씨 영향 다른가?
```

![graph5.png](attachment:1ea11b86-d2f5-4e88-8b1c-590facb7e715:graph5.png)

📌 주요 발견:

- 월별: 3-5월(봄) 최다, 8월·1월 최소
- 계절: 봄 > 가을 > 여름 = 겨울
- 요일: 금요일 > 월요일 (+9.5%)
- 주말: 평일의 55-75% 수준
- 연도: 2024년이 2023년보다 약간 증가 (COVID 회복)

---

# **STEP 3: 임계점 발견**

## 3-1. 구간별 승차인원 평균 비교

```sql
⭐ 온도 임계점 ⭐
쾌적한 날씨 (5-25°C):  5.0M명 (최대)
한파 (<-5°C):          4.2M명 (-13.6%) ⚠️
폭염 (>30°C):          4.6M명 (-5.6%) ⚠️
```
- U자형 패턴 확인: 극한 기온에서 외출 자체가 감소
- 한파가 폭염보다 영향 큼: -13.6% vs -5.6%
- 임계점: -5°C 이하 / 30°C 이상
```

```sql
⭐ 강수량 임계점 ⭐
맑음 (0mm):        +0.7%
약한비 (<5mm):     -1.2%
보통비 (5-20mm):   -0.1%
강한비 (20-50mm):  -1.3%
폭우 (50mm+):      -8.9% ⚠️ 임계점!
```

## 3-2. 통계 검정

- t-test: 비 온 날 vs 맑은 날 승차인원 차이 유의미한가?
- ANOVA: 온도 구간별 승차인원 차이 유의미한가?

---

# **STEP 4: 가설 검증**

### 원래 가설:

> "날씨가 나쁠수록 지하철 이용 증가, 하지만 '너무 나쁘면' 오히려 통행량 감소"
> 

### 검증 방법:

1. **약한 비 (1-10mm)**: 승차인원 증가 확인 ✓
2. **강한 비 (20mm 이상)**: 승차인원 감소 확인 ✓
3. **쾌적한 날씨 (15-25°C)**: 승차인원 감소 (도보/자전거 증가) ✓
4. **극한 날씨 (폭염/한파)**: 승차인원 증가 ✓

---

# **STEP 5: 심화 분석 (옵션)**

## 5-1. 역별 차이

- 업무지구 역 vs 주거지역 역
- 날씨 영향이 더 큰 역은 어디?

## 5-2. 요일 효과

- 평일 vs 주말
- 비 오는 주말: 외출 취소로 대폭 감소?

## 5-3. 회귀 분석

```sql
승차인원 = β0 + β1(기온) + β2(기온²) + β3(강수여부) + β4(요일) + ε
→ 각 변수의 영향력 정량화
```

---

# **STEP 6: 예상 결과 및 인사이트**

패턴 : 

- **약한 비 (5-10mm)**: 버스→지하철 전환으로 승차 인원 5-10% 증가
- **강한 비 (20mm+)**: 재택근무/외출 취소로 승차 인원 감소
- **쾌적한 날씨**: 도보/자전거 이용 증가로 지하철 이용 약간 감소
- **극한 기온**: 실내 교통수단 선호로 지하철 이용 증가